<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>转换高清图片</title>
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        .hhh {
            width: 100vw;
            height: 100vh;
        }

        .hide {
            display: none;
            pointer-events: none;
        }

        .hideOpacity {
            opacity: 0;
        }

        .loading {
            width: 100%;
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .showIt {
            display: block;
        }
    </style>

    <script>
        /** 浏览器指纹 */
        let liulanqizhiwen = '';
        /** 是否有当前页面的权限 */
        let canUsePage = false;


        // Initialize the agent at application startup.
        const fpPromise = import('https://openfpcdn.io/fingerprintjs/v3')
            .then(FingerprintJS => FingerprintJS.load())

        // Get the visitor identifier when you need it.
        fpPromise
            .then(fp => fp.get())
            .then(result => {
                // This is the visitor identifier:
                const visitorId = result.visitorId
                liulanqizhiwen = String(visitorId);
                document.getElementById('zhiwen').innerHTML = liulanqizhiwen;
                console.log('visitorId', visitorId)

                $.ajax({
                    url: "https://dev.usemock.com/64b5fd479da07a3275fdfafa/convert_high_px_img", success: function (result) {
                        const whiteList = result.list;
                        console.log('file whiteList', whiteList);
                        const host = window.location.host // 当前网站的域名

                        whiteList.map(item => {
                            if (String(item) === String(liulanqizhiwen)) {
                                canUsePage = true;
                            }
                        })
                        if (canUsePage) {
                            $("#iframeDom").attr('class', "showIt hhh")
                            $("#btn_wrapper").attr('class', "hide")
                        }
                    }
                })

            })

    </script>
</head>

<body>

    <div class="loading" id="btn_wrapper">
        <div id="zhiwen"></div>
        <button id="btn">复制登陆码</button>
    </div>


    <iframe id="iframeDom" class="hhh hideOpacity" scroll="no"
        src="https://www.cutout.pro/zh-CN/photo-enhancer-sharpener-upscaler/upload"></iframe>
</body>

<script>
    window.onload = function () {
        const protectCodeKey = () => {
            document.onkeydown = function () {
                const e = window.event || arguments[0]
                // F12
                if (e.keyCode == 123)
                    return false
                // Ctrl+Shift+I

                else if ((e.ctrlKey) && (e.shiftKey) && (e.keyCode == 73))
                    return false
                // Shift+F10

                else if ((e.shiftKey) && (e.keyCode == 121))
                    return false
                // Ctrl+U

                else if ((e.ctrlKey) && (e.keyCode == 85))
                    return false
            }
            // 屏蔽鼠标右键
            document.oncontextmenu = function () {
                return false
            }
        }

        const protectCode = () => {
            protectCodeKey();
            ((function () {
                let callbacks = []
                const timeLimit = 50
                let open = false
                setInterval(loop, 1)
                return {
                    addListener(fn) {
                        callbacks.push(fn)
                    },
                    cancleListenr(fn) {
                        callbacks = callbacks.filter((v) => {
                            return v !== fn
                        })
                    },
                }

                function loop() {
                    const startTime = new Date()
                    debugger
                    if (new Date() - startTime > timeLimit) {
                        if (!open) {
                            callbacks.forEach((fn) => {
                                fn.call(null)
                            })
                        }
                        open = true
                        window.stop()
                        // alert('⚠️禁止');
                        document.body.innerHTML = ''
                    }
                    else {
                        open = false
                    }
                }
            })()).addListener(() => {
                window.location.reload()
            })
        }
        protectCode();

        // console.log('file d--dd, ', document.getElementById('iframeDom').contentWindow.window.getElementById('__layout'))
        // console.log('file d--dd, ', $('#iframeDom').contents().find('#__layout'))


        // document.getElementById('iframeDom').onload = function () {
        //     console.log('file --- ', document.getElementById('iframeDom').contentWindow.document)
        //     const iframeDOMYin = document.getElementById('iframeDom').contentWindow;
        //     iframeDOMYin.document.body.style.background = 'red'

        // }
    }




    const btn = document.querySelector('#btn');
    btn.addEventListener('click', async () => {
        if (navigator.clipboard) {
            await navigator.clipboard.writeText(liulanqizhiwen)
        }
    })

</script>

</html>
